
<!--
	Reference URL: https://navigation.ros.org/behavior_trees/trees/nav_to_pose_with_consistent_replanning_and_if_path_becomes_invalid.html

Navigate To Pose With Consistent Replanning And If Path Becomes Invalid

	This behavior tree for navigation in ROS2 emphasizes robustness and flexibility. It retries
navigation tasks up to 6 times, incorporating custom recoveries for planner and controller failures.
It dynamically replans based on invalid paths or new goals, ensuring responsiveness and adaptability
in complex environments. Additionally, it allows for algorithm selection through external
applications, enhancing usability and scalability.

	This Behavior Tree replans the global path periodically at 1 Hz and it also has
In nominal execution, replanning can be triggered by an a invalid previous path, a new goal or if a
new path has not been created for 10 seconds. If the planner or controller fails, it will trigger
contextually aware recoveries in its subtree. Currently, the recoveries will clear the global
costmap if the planner fails and clear the local costmap if the controller fails. Additional
context-specific recoveries can be added to these subtrees.
-->
<root main_tree_to_execute="MainTree">
	<BehaviorTree ID="MainTree">
		<RecoveryNode number_of_retries="3" name="NavigateRecovery">
			<PipelineSequence name="NavigateWithReplanning">
				<RateController hz="2.0">
					<RecoveryNode number_of_retries="1" name="ComputePathToPose">
						<Fallback>
							<ReactiveSequence>
								<Inverter>
									<PathExpiringTimer seconds="10" path="{path}" />
								</Inverter>
								<Inverter>
									<GlobalUpdatedGoal />
								</Inverter>
								<IsPathValid path="{path}" />
							</ReactiveSequence>
							<ComputePathToPose goal="{goal}" path="{path}" planner_id="GridBased" />
						</Fallback>
						<ClearEntireCostmap name="ClearLocalCostmap-Context"
							service_name="local_costmap/clear_entirely_local_costmap" />
					</RecoveryNode>
				</RateController>
				<RecoveryNode number_of_retries="1" name="FollowPath">
					<FollowPath path="{path}" controller_id="FollowPath" />
					<ClearEntireCostmap name="ClearLocalCostmap-Context"
						service_name="local_costmap/clear_entirely_local_costmap" />
				</RecoveryNode>
			</PipelineSequence>
			<ReactiveFallback name="RecoveryFallback">
				<GoalUpdated />
				<RoundRobin name="RecoveryActions">
					<Sequence name="ClearingActions">
						<ClearEntireCostmap name="ClearLocalCostmap-Subtree"
							service_name="local_costmap/clear_entirely_local_costmap" />
						<ClearEntireCostmap name="ClearGlobalCostmap-Subtree"
							service_name="global_costmap/clear_entirely_global_costmap" />
					</Sequence>
					<Spin spin_dist="1.57" />
					<Wait wait_duration="1" />
					<BackUp backup_dist="0.5" backup_speed="0.1" />
				</RoundRobin>
			</ReactiveFallback>
		</RecoveryNode>
	</BehaviorTree>
</root>